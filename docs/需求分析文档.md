# 河南麻将线上游戏需求分析文档

## 1. 项目概述

### 1.1 项目简介
本项目旨在开发一款基于Web的河南麻将线上游戏平台，支持多人实时对战、观战模式，并专门针对移动端进行优化。

### 1.2 项目目标
- 实现完整的河南麻将游戏规则
- 提供流畅的多人实时游戏体验
- 支持移动端和PC端访问
- 实现房间创建和管理功能
- 提供观战模式

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 房间管理
- **创建房间**
  - 用户可创建新房间
  - 系统自动生成唯一房间号
  - 创建者可选择房间设置（游戏规则、房间人数等）

- **加入房间**
  - 用户可通过房间号进入房间
  - 支持通过邀请链接直接加入房间
  - 房间人数已满时提示是否观战

- **房间状态管理**
  - 显示房间内玩家列表
  - 显示玩家准备状态
  - 支持玩家离开房间

#### 2.1.2 游戏流程
- **准备阶段**
  - 玩家点击准备按钮
  - 所有人准备好后自动开始游戏
  - 房主可强制开始游戏（3人以上）

- **游戏进行**
  - 实现河南麻将完整规则
  - 支持摸牌、出牌、吃、碰、杠、胡等操作
  - 实时同步游戏状态到所有玩家
  - 支持混牌（赖子）功能

- **游戏结束**
  - 显示游戏结果
  - 计算分数
  - 返回房间准备下一局

#### 2.1.3 观战模式
- 用户可选择观战已满的房间
- 观战者可以看到所有玩家的手牌
- 观战者不能参与游戏操作
- 支持多个观战者同时观战

### 2.2 辅助功能

#### 2.2.1 用户界面
- **移动端适配**
  - 响应式设计，适配手机屏幕
  - 触摸友好的操作界面
  - 横竖屏切换支持

- **PC端支持**
  - 支持鼠标操作
  - 键盘快捷键支持

#### 2.2.2 游戏体验
- **实时通信**
  - WebSocket连接实现低延迟通信
  - 断线重连机制
  - 网络状态显示

- **游戏设置**
  - 音效开关
  - 背景音乐开关
  - 牌面主题选择

## 3. 河南麻将规则

### 3.1 基本规则
- **牌数**：使用144张麻将牌（包含字牌）
- **人数**：4人游戏
- **混牌**：每局随机确定一张牌作为混牌（赖子），可当任意牌使用
- **胡牌方式**：支持平胡、七对、清一色、混一色等

### 3.2 特殊规则
- **只能碰不能吃**：河南麻将特色规则
- **杠牌计分**：明杠、暗杠不同计分
- **混牌使用**：混牌可当任意牌组成胡牌型
- **包胡规则**：某些情况下需要承担包胡责任

### 3.3 计分规则
- **基础分**：根据胡牌型确定基础分数
- **番数计算**：特殊牌型额外加番
- **杠分**：杠牌数量影响最终分数
- **混牌奖励**：使用混牌胡牌有额外奖励

## 4. 非功能性需求

### 4.1 性能要求
- **响应时间**：用户操作响应时间<100ms
- **网络延迟**：游戏状态同步延迟<200ms
- **并发支持**：支持至少1000个房间同时进行
- **内存使用**：单个房间内存占用<10MB

### 4.2 可用性要求
- **系统可用性**：99.9%以上
- **断线重连**：网络断开后自动重连并恢复游戏状态
- **数据备份**：定期备份游戏数据

### 4.3 兼容性要求
- **浏览器支持**：
  - 移动端：iOS Safari 12+, Android Chrome 70+
  - PC端：Chrome 70+, Firefox 65+, Safari 12+, Edge 79+
- **设备支持**：手机、平板、桌面电脑

## 5. 用户场景

### 5.1 典型用户流程
1. 用户打开游戏网页
2. 选择创建房间或加入房间
3. 进入房间等待其他玩家
4. 所有玩家准备后开始游戏
5. 进行河南麻将游戏
6. 游戏结束后返回房间继续下一局

### 5.2 观战流程
1. 用户选择加入房间
2. 房间满员时提示观战选项
3. 进入观战模式观看游戏
4. 可随时离开观战

## 6. 系统约束

### 6.1 技术约束
- 前端必须使用Vue 3 + Element Plus
- 后端必须使用Spring Boot 3.4.5
- 数据库必须使用MySQL
- 必须使用JPA + MyBatis架构

### 6.2 业务约束
- 不需要用户注册登录系统
- 房间号必须是唯一的
- 每个房间最多4名玩家
- 观战人数不设上限

### 6.3 安全约束
- 防止SQL注入攻击
- 防止XSS攻击
- WebSocket连接需要安全验证
- 游戏数据需要防篡改

## 7. 验收标准

### 7.1 功能验收
- 房间创建和加入功能正常
- 河南麻将规则完整实现
- 移动端和PC端界面正常显示和操作
- 观战模式功能正常
- 实时游戏状态同步准确

### 7.2 性能验收
- 满足性能要求中的响应时间指标
- 支持预期的并发用户数
- 移动端在各种网络条件下稳定运行

### 7.3 用户体验验收
- 界面美观，操作流畅
- 移动端触摸操作友好
- 游戏规则清晰易懂
- 错误提示友好明确